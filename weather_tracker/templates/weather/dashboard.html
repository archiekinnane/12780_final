<!doctype html>
{% load static %}
<html>
  <head>
    <meta charset="utf-8">
    <title>Dashboard</title>
  </head>
  <body>
    <h1>Weather Dashboard</h1>
    <nav style="margin-bottom: 1.5rem;">
    <a href="{% url 'weather:submit' %}">Request New Query</a> |
    <a href="{% url 'weather:submit_data' %}">Submit Data</a> |
    <a href="/admin/" target="_blank">Admin</a>
  </nav>

    <p>Total queries: <strong>{{ queries|length }}</strong></p>


    <h2>Status breakdown</h2>

    <canvas id="statusChart"  height="30"></canvas>
    {{ status_labels|json_script:"status-labels" }}
    {{ status_values|json_script:"status-values" }}

    <h2>Statistics over time</h2>
    {{ time_labels|json_script:"time-labels" }}
    {{ time_values|json_script:"time-values" }}
    

    <canvas id="timeChart"  height="30"></canvas>

    <form method="get" style="margin-bottom: 1rem;">
      <label>
        Metric:
        <select name="metric">
          {% for value,label in metric_options %}
            <option value="{{ value }}" {% if value == selected_metric %}selected{% endif %}>
              {{ label }}
            </option>
          {% endfor %}
        </select>
      </label>

      <label style="margin-left: 1rem;">
        Year:
        <select name="year">
          {% for y in year_options %}
            <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>
              {{ y }}
            </option>
          {% endfor %}
        </select>
      </label>

      <button type="submit" style="margin-left: 1rem;">Update</button>
    </form>

    <h2>Change vs baseline by location</h2>
    <p style="margin-top:0;">
      Showing change in <strong>{{ selected_metric }}</strong> for <strong>{{ selected_year }}</strong>
      vs baseline <strong>{{ queries.0.baseline_start_year }}â€“{{ queries.0.baseline_end_year }}</strong>
    </p>

    <canvas id="deltaChart" height="140"></canvas>
    {{ delta_labels|json_script:"delta-labels" }}
    {{ delta_values|json_script:"delta-values" }}
    {{ selected_metric_label|json_script:"selected-metric-label" }}

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{% static 'weather/dashboard.js' %}"></script> 



  </body>
</html>